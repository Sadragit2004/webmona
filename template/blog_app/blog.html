{% extends 'main_template.html' %}
{% load static %}

{% block content %}
<main class="pt-8 pb-16 lg:pt-16 lg:pb-24 bg-white dark:bg-gray-900 antialiased">
  <div class="flex justify-between px-4 mx-auto max-w-screen-xl">
      <article class="mx-auto w-full max-w-2xl format format-sm sm:format-base lg:format-lg format-blue dark:format-invert">
          <header class="mb-4 lg:mb-6 not-format">
              <!-- بخش بهبود یافته اطلاعات نویسنده -->
              <div class="author-section mb-8">
                  <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4 p-4 bg-gray-50 rounded-lg dark:bg-gray-800">
                      {% if blog.Auther_blog.all %}
                          <!-- آواتار نویسنده -->
                          <div class="flex-shrink-0">
                              <div class="w-16 h-16 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-xl shadow-md">
                                  {{ blog.Auther_blog.first.Author_name|first }}
                              </div>
                          </div>

                          <!-- اطلاعات نویسنده -->
                          <div class="flex-1">
                              <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
                                  <div>
                                      <a href="#" rel="author" class="text-xl font-bold text-gray-900 dark:text-white hover:text-blue-600 transition-colors">
                                          {{ blog.Auther_blog.first.Author_name }}
                                      </a>
                                      <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">نویسنده مقاله</p>
                                  </div>

                                  <!-- اطلاعات تاریخ و زمان مطالعه -->
                                  <div class="flex flex-col sm:items-end text-sm text-gray-500 dark:text-gray-400">
                                      <div class="flex items-center gap-1">
                                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                          </svg>
                                          <time pubdate datetime="{{ blog.register_data|date:'Y-m-d' }}" title="{{ blog.get_jalali_register_date }}">
                                              {{ blog.get_jalali_register_date }}
                                          </time>
                                      </div>
                                      <div class="flex items-center gap-1 mt-1">
                                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                          </svg>
                                          <span>{{ blog.time_read }} زمان مطالعه</span>
                                      </div>
                                  </div>
                              </div>

                              <!-- بیوگرافی نویسنده (در صورت وجود) -->
                              {% if blog.Auther_blog.first.bio %}
                              <div class="mt-3 text-sm text-gray-600 dark:text-gray-300 leading-relaxed">
                                  {{ blog.Auther_blog.first.bio|truncatewords:20 }}
                              </div>
                              {% endif %}
                          </div>
                      {% else %}
                          <!-- حالت پیش‌فرض (تیم فودیلایو) -->
                          <div class="flex-shrink-0">
                              <div class="w-16 h-16 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-xl shadow-md">
                                  ف
                              </div>
                          </div>
                          <div class="flex-1">
                              <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
                                  <div>
                                      <a href="#" rel="author" class="text-xl font-bold text-gray-900 dark:text-white hover:text-blue-600 transition-colors">تیم فودیلایو</a>
                                      <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">تیم تولید محتوا</p>
                                  </div>
                                  <div class="flex flex-col sm:items-end text-sm text-gray-500 dark:text-gray-400">
                                      <div class="flex items-center gap-1">
                                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                          </svg>
                                          <span>{{ blog.get_jalali_register_date }}</span>
                                      </div>
                                      <div class="flex items-center gap-1 mt-1">
                                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                          </svg>
                                          <span>{{ blog.time_read }} زمان مطالعه</span>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      {% endif %}
                  </div>
              </div>

              <!-- عنوان مقاله -->
              <h1 class="mb-4 text-3xl font-extrabold leading-tight text-gray-900 lg:mb-6 lg:text-4xl dark:text-white">
                  {{ blog.subject }}
              </h1>

              <!-- متا اطلاعات -->
              <div class="flex flex-wrap items-center gap-4 mb-6 text-sm text-gray-500 dark:text-gray-400">
                  <div class="flex items-center gap-1">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                      </svg>
                      <span>{{ blog.view }} بازدید</span>
                  </div>
                  <div class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-blue-900 dark:text-blue-300">
                      {{ blog.grop_blog.group_name }}
                  </div>
              </div>

              <!-- عکس اصلی -->
              {% if blog.image_name %}
              <figure class="mb-8">
                  <img src="{{ blog.image_name.url }}" alt="{{ blog.subject }}" class="w-full h-auto rounded-lg shadow-lg">
                  <figcaption class="mt-2 text-sm text-center text-gray-500 dark:text-gray-400">
                      {{ blog.subject }}
                  </figcaption>
              </figure>
              {% endif %}
          </header>

          <!-- توضیحات اولیه -->
          {% if blog.description %}
          <div class="mb-8 p-6 bg-gray-50 rounded-lg dark:bg-gray-800">
              <p class="text-lg leading-relaxed text-gray-700 dark:text-gray-300">{{ blog.description }}</p>
          </div>
          {% endif %}

          <!-- محتوای اصلی -->
          {% if blog.description2 %}
          <div class="prose max-w-none dark:prose-invert">
              {{ blog.description2|safe }}
          </div>
          {% endif %}

          <!-- سوالات متداول -->
          {% if blog.blog_faq.all %}
          <section class="mt-12">
              <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">سوالات متداول</h2>
              <div class="space-y-4">
                  {% for faq in blog.blog_faq.all %}
                  <div class="bg-gray-50 rounded-lg p-6 dark:bg-gray-800">
                      <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">{{ faq.qus }}</h3>
                      <p class="text-gray-700 dark:text-gray-300 leading-relaxed">{{ faq.answer }}</p>
                  </div>
                  {% endfor %}
              </div>
          </section>
          {% endif %}

          <!-- تگ‌ها -->
          {% if blog.key_words %}
          <section class="mt-12">
              <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">کلمات کلیدی</h2>
              <div class="flex flex-wrap gap-2">
                  {% for tag in blog.key_words.split %}
                  <span class="bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded dark:bg-blue-900 dark:text-blue-300">
                      {{ tag }}
                  </span>
                  {% endfor %}
              </div>
          </section>
          {% endif %}

          <!-- بخش بهبود یافته نویسندگان -->
          {% if blog.Auther_blog.all and blog.Auther_blog.count > 1 %}
          <section class="mt-12">
              <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">نویسندگان این مقاله</h2>
              <div class="grid gap-4 md:grid-cols-2">
                  {% for author in blog.Auther_blog.all %}
                  <div class="flex items-start space-x-4 p-4 bg-gray-50 rounded-lg dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                      <div class="flex-shrink-0">
                          <div class="w-12 h-12 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold shadow-md">
                              {{ author.Author_name|first }}
                          </div>
                      </div>
                      <div class="flex-1">
                          <h3 class="text-lg font-semibold text-gray-900 dark:text-white">{{ author.Author_name }}</h3>
                          <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">نویسنده</p>
                          {% if author.bio %}
                          <p class="text-sm text-gray-600 dark:text-gray-300 mt-2 leading-relaxed">{{ author.bio|truncatewords:15 }}</p>
                          {% endif %}
                      </div>
                  </div>
                  {% endfor %}
              </div>
          </section>
          {% endif %}
      </article>
  </div>
</main>

<!-- مقالات مرتبط -->
{% if related_articles %}
<aside aria-label="مقالات مرتبط" class="py-8 lg:py-16 bg-gray-50 dark:bg-gray-800">
  <div class="px-4 mx-auto max-w-screen-xl">
      <h2 class="mb-8 text-2xl font-bold text-gray-900 dark:text-white">مقالات مرتبط</h2>
      <div class="grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
          {% for related in related_articles|slice:":3" %}
          <article class="max-w-xs mx-auto bg-white rounded-lg shadow-md dark:bg-gray-900 overflow-hidden hover:shadow-lg transition-shadow">
              <a href="{{ related.get_absolute_url }}">
                  {% if related.image_name %}
                  <img src="{{ related.image_name.url }}" class="w-full h-48 object-cover" alt="{{ related.subject }}">
                  {% else %}
                  <div class="w-full h-48 bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center text-white">
                      <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9m0 0v2m0-2a2 2 0 012-2h2a2 2 0 012 2m-6 5v2m0-2a2 2 0 012-2h2a2 2 0 012 2m0 0v2"/>
                      </svg>
                  </div>
                  {% endif %}
              </a>
              <div class="p-4">
                  <h2 class="mb-2 text-xl font-bold leading-tight text-gray-900 dark:text-white line-clamp-2">
                      <a href="{{ related.get_absolute_url }}">{{ related.subject }}</a>
                  </h2>
                  <p class="mb-4 text-gray-500 dark:text-gray-400 line-clamp-2">{{ related.description|truncatewords:20 }}</p>
                  <a href="{{ related.get_absolute_url }}" class="inline-flex items-center font-medium text-blue-600 dark:text-blue-500 hover:underline">
                      مطالعه مقاله
                      <svg class="mr-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
                      </svg>
                  </a>
              </div>
          </article>
          {% endfor %}
      </div>
  </div>
</aside>
{% endif %}

<!-- خبرنامه -->
<section class="bg-white dark:bg-gray-900">
  <div class="py-8 px-4 mx-auto max-w-screen-xl lg:py-16 lg:px-6">
      <div class="mx-auto max-w-screen-md text-center">
          <h2 class="mb-4 text-3xl font-extrabold tracking-tight text-gray-900 sm:text-4xl dark:text-white">در خبرنامه ما عضو شوید</h2>
          <p class="mx-auto mb-8 max-w-2xl text-gray-500 md:mb-12 sm:text-xl dark:text-gray-400">
              از آخرین مقالات و آموزش‌های حوزه رستوران‌داری و مدیریت منو با خبر شوید
          </p>
          <form action="#">
              <div class="items-center mx-auto mb-3 space-y-4 max-w-screen-sm sm:flex sm:space-y-0">
                  <div class="relative w-full">
                      <label for="email" class="hidden mb-2 text-sm font-medium text-gray-900 dark:text-gray-300">آدرس ایمیل</label>
                      <div class="flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none">
                          <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" fill="currentColor" viewBox="0 0 20 16">
                              <path d="m10.036 8.278 9.258-7.79A1.979 1.979 0 0 0 18 0H2A1.987 1.987 0 0 0 .641.541l9.395 7.737Z"/>
                              <path d="M11.241 9.817c-.36.275-.801.425-1.255.427-.428 0-.845-.138-1.187-.395L0 2.6V14a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V2.5l-8.759 7.317Z"/>
                          </svg>
                      </div>
                      <input class="block p-3 pl-9 w-full text-sm text-gray-900 bg-white rounded-lg border border-gray-300 sm:rounded-none sm:rounded-l-lg focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="ایمیل خود را وارد کنید" type="email" id="email" required>
                  </div>
                  <div>
                      <button type="submit" class="py-3 px-5 w-full text-sm font-medium text-center text-white rounded-lg border cursor-pointer bg-blue-700 border-blue-600 sm:rounded-none sm:rounded-r-lg hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
                          عضو شوید
                      </button>
                  </div>
              </div>
              <div class="mx-auto max-w-screen-sm text-sm text-center text-gray-500 newsletter-form-footer dark:text-gray-300">
                  ما از اطلاعات شما محافظت می‌کنیم.
                  <a href="#" class="font-medium text-blue-600 dark:text-blue-500 hover:underline">حریم خصوصی</a>.
              </div>
          </form>
      </div>
  </div>
</section>

<style>
.prose {
  max-width: none;
  line-height: 1.75;
}

.prose p {
  margin-bottom: 1.25em;
}

.prose h2 {
  font-size: 1.5em;
  margin-top: 2em;
  margin-bottom: 1em;
  font-weight: 700;
  line-height: 1.3333333;
  color: #1f2937;
}

.dark .prose h2 {
  color: #f9fafb;
}

.prose h3 {
  font-size: 1.25em;
  margin-top: 1.6em;
  margin-bottom: 0.6em;
  font-weight: 600;
  line-height: 1.6;
}

.prose ul, .prose ol {
  margin-top: 1.25em;
  margin-bottom: 1.25em;
  padding-right: 1.625em;
}

.prose li {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

.prose blockquote {
  font-weight: 500;
  font-style: italic;
  border-right-width: 0.25rem;
  border-right-color: #e5e7eb;
  quotes: "\201C""\201D""\2018""\2019";
  margin-top: 1.6em;
  margin-bottom: 1.6em;
  padding-right: 1em;
}

.dark .prose blockquote {
  border-right-color: #4b5563;
}

.prose table {
  width: 100%;
  table-layout: auto;
  text-align: right;
  margin-top: 2em;
  margin-bottom: 2em;
  font-size: 0.875em;
  line-height: 1.7142857;
}

.prose thead {
  border-bottom-width: 1px;
  border-bottom-color: #d1d5db;
}

.dark .prose thead {
  border-bottom-color: #4b5563;
}

.prose thead th {
  padding-right: 0.5714286em;
  padding-bottom: 0.5714286em;
  padding-left: 0.5714286em;
  font-weight: 600;
  vertical-align: bottom;
}

.prose tbody tr {
  border-bottom-width: 1px;
  border-bottom-color: #e5e7eb;
}

.dark .prose tbody tr {
  border-bottom-color: #374151;
}

.prose tbody td {
  padding: 0.5714286em;
}

.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.author-section {
  border-bottom: 1px solid #e5e7eb;
  padding-bottom: 1.5rem;
}

.dark .author-section {
  border-bottom-color: #374151;
}
</style>
{% endblock %}