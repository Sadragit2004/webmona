<!-- فایل: panel_dashboard.html -->
{% load humanize %}

<div class="w-full max-w-7xl mx-auto p-4">

    <!-- بنر افتتاح اولین منو - برای کاربران بدون منو -->
    <div id="firstTimeBanner" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm transform transition-all duration-500 scale-95 animate-in">
            <div class="p-6 text-center">
                <!-- آیکون بزرگ -->
                <div class="w-20 h-20 bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-utensils text-white text-2xl"></i>
                </div>

                <!-- متن بنر -->
                <h3 class="text-xl font-bold text-gray-800 mb-3">منوی آنلاین خودت رو بساز!</h3>
                <p class="text-gray-600 mb-6 text-sm leading-relaxed">
                    با ساخت منوی دیجیتال، کسب و کارت رو متحول کن و سفارشاتت رو چند برابر افزایش بده
                </p>

                <!-- دکمه‌های اقدام -->
                <div class="space-y-3">
                    <button onclick="startCreatingMenu()"
                            class="w-full bg-gradient-to-br from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white py-4 rounded-xl font-bold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg">
                        <i class="fas fa-rocket ml-2"></i>
                        شروع کن، رایگان!
                    </button>

                    <button onclick="closeFirstTimeBanner()"
                            class="w-full bg-gray-100 hover:bg-gray-200 text-gray-600 py-3 rounded-xl font-medium transition-colors">
                        بعداً می‌سازم
                    </button>
                </div>

                <!-- نکات مثبت -->
                <div class="mt-6 pt-4 border-t border-gray-200">
                    <div class="grid grid-cols-2 gap-3 text-xs text-gray-500">
                        <div class="flex items-center justify-center">
                            <i class="fas fa-bolt text-yellow-500 ml-1"></i>
                            <span>سریع و آسان</span>
                        </div>
                        <div class="flex items-center justify-center">
                            <i class="fas fa-qrcode text-blue-500 ml-1"></i>
                            <span>QR Code رایگان</span>
                        </div>
                        <div class="flex items-center justify-center">
                            <i class="fas fa-mobile text-purple-500 ml-1"></i>
                            <span>ریسپانسیو</span>
                        </div>
                        <div class="flex items-center justify-center">
                            <i class="fas fa-chart-line text-green-500 ml-1"></i>
                            <span>افزایش فروش</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- آمار کلی -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
        <!-- کارت منوهای ساخته شده -->
        <div class="bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl p-6 shadow-lg hover-lift transition-all duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-blue-100 text-sm mb-2">منوهای ساخته شده</p>
                    <h3 class="text-2xl font-bold">{{ user_restaurants.count|default:0 }}</h3>
                    <p class="text-blue-100 text-xs mt-2">همه منوهای فعال</p>
                </div>
                <div class="w-14 h-14 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                    <i class="fas fa-utensils text-2xl"></i>
                </div>
            </div>
        </div>

        <!-- کارت منوهای خریداری شده -->
        <div class="bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl p-6 shadow-lg hover-lift transition-all duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-green-100 text-sm mb-2">منوهای خریداری شده</p>
                    <h3 class="text-2xl font-bold">{{ purchased_menus|default:0 }}</h3>
                    <p class="text-green-100 text-xs mt-2">پکیج‌های فعال</p>
                </div>
                <div class="w-14 h-14 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                    <i class="fas fa-shopping-cart text-2xl"></i>
                </div>
            </div>
        </div>

        <!-- کارت سفارشات امروز -->
        <div class="bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-xl p-6 shadow-lg hover-lift transition-all duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-purple-100 text-sm mb-2">سفارشات امروز</p>
                    <h3 class="text-2xl font-bold">{{ today_orders|default:0 }}</h3>
                    <p class="text-purple-100 text-xs mt-2">24 ساعت گذشته</p>
                </div>
                <div class="w-14 h-14 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                    <i class="fas fa-receipt text-2xl"></i>
                </div>
            </div>
        </div>

        <!-- کارت درآمد امروز -->
        <div class="bg-gradient-to-br from-orange-500 to-orange-600 text-white rounded-xl p-6 shadow-lg hover-lift transition-all duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-orange-100 text-sm mb-2">درآمد امروز</p>
                    <h3 class="text-2xl font-bold">{{ today_revenue|default:0|intcomma }}</h3>
                    <p class="text-orange-100 text-xs mt-2">تومان</p>
                </div>
                <div class="w-14 h-14 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                    <i class="fas fa-wallet text-2xl"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- بخش سفارشات منو -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 mb-6">
        <div class="p-6 border-b border-gray-100">
            <h2 class="text-xl font-bold text-gray-800 flex items-center">
                <i class="fas fa-shopping-cart text-blue-500 ml-3 text-lg"></i>
                سفارشات ساخت منو
            </h2>
            <p class="text-gray-600 text-sm mt-2">مدیریت سفارشات ساخت منوی حرفه‌ای</p>
        </div>

        <div class="p-6">
            {% if user_orders %}
            <div class="space-y-4">
                {% for order in user_orders %}
                {% with status_info=order.get_status_info %}
                <div class="border border-gray-200 rounded-xl p-5 hover:shadow-lg transition-all duration-300">
                    <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4">
                        <!-- اطلاعات سفارش -->
                        <div class="flex-1">
                            <div class="flex items-center flex-wrap gap-2 mb-4">
                                <!-- وضعیت داینامیک -->
                                <span class="status-badge px-3 py-1 rounded-lg text-sm font-medium
                                    {% if order.status == 1 %}bg-red-100 text-red-600 border border-red-200{% endif %}
                                    {% if order.status == 2 %}bg-green-100 text-green-600 border border-green-200{% endif %}
                                    {% if order.status == 3 %}bg-purple-100 text-purple-600 border border-purple-200{% endif %}
                                    {% if order.status == 4 %}bg-blue-100 text-blue-600 border border-blue-200{% endif %}
                                    {% if order.status == 5 %}bg-teal-100 text-teal-600 border border-teal-200{% endif %}
                                    {% if order.status == 6 %}bg-orange-100 text-orange-600 border border-orange-200{% endif %}">
                                    <i class="fas
                                        {% if order.status == 1 %}fa-clock{% endif %}
                                        {% if order.status == 2 %}fa-check-circle{% endif %}
                                        {% if order.status == 3 %}fa-clipboard-check{% endif %}
                                        {% if order.status == 4 %}fa-check-double{% endif %}
                                        {% if order.status == 5 %}fa-sync-alt{% endif %}
                                        {% if order.status == 6 %}fa-times-circle{% endif %}
                                        ml-1 text-xs"></i>
                                    {{ order.get_status_display }}
                                </span>

                                <!-- شماره سفارش -->
                                <span class="bg-gray-100 text-gray-600 px-3 py-1 rounded-lg text-sm font-medium border border-gray-200">
                                    <i class="fas fa-hashtag ml-1 text-xs"></i>
                                    #{{ order.id }}
                                </span>

                                <!-- رستوران -->
                                <span class="bg-orange-100 text-orange-600 px-3 py-1 rounded-lg text-sm font-medium border border-orange-200">
                                    <i class="fas fa-store ml-1 text-xs"></i>
                                    {{ order.restaurant.title }}
                                </span>

                                <!-- قیمت -->
                                <span class="bg-indigo-100 text-indigo-600 px-3 py-1 rounded-lg text-sm font-medium border border-indigo-200">
                                    <i class="fas fa-tag ml-1 text-xs"></i>
                                    {{ order.get_price_display }}
                                </span>
                            </div>

                            <!-- اطلاعات رستوران -->
                            <div class="mb-4">
                                <p class="text-gray-700 font-medium text-lg">{{ order.restaurant.title }}</p>
                                <p class="text-gray-500 text-sm mt-1">
                                    <i class="fas fa-link ml-1 text-gray-400"></i>
                                    آدرس: /menu/{{ order.restaurant.english_name }}
                                </p>
                            </div>

                            <!-- اطلاعات قیمت داینامیک -->
                            <div class="bg-gray-50 rounded-lg p-4 mb-4">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                                    <div class="text-center">
                                        <p class="text-gray-600">قیمت پایه</p>
                                        <p class="font-bold text-gray-800">{{ order.get_base_price_display }}</p>
                                    </div>
                                    {% if order.is_seo_enabled %}
                                    <div class="text-center">
                                        <p class="text-purple-600">هزینه سئو</p>
                                        <p class="font-bold text-purple-600">{{ order.get_seo_price_display }}</p>
                                    </div>
                                    {% endif %}
                                    <div class="text-center">
                                        <p class="text-green-600">قیمت نهایی</p>
                                        <p class="font-bold text-green-600 text-lg">{{ order.get_price_display }}</p>
                                    </div>
                                </div>
                            </div>

                            <!-- اطلاعات زمانی -->
                            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between pt-4 border-t border-gray-100 space-y-2 sm:space-y-0">
                                <div class="flex items-center text-sm text-gray-600">
                                    <i class="fas fa-clock ml-1"></i>
                                    تاریخ ایجاد:
                                    <span class="font-medium mr-1">{{ order.created_at|date:"Y/m/d - H:i" }}</span>
                                </div>
                                <div class="text-sm text-gray-600">
                                    <i class="fas fa-info-circle ml-1"></i>
                                    سئو: {% if order.is_seo_enabled %}فعال{% else %}غیرفعال{% endif %}
                                </div>
                            </div>

                            <!-- عکس‌های آپلود شده -->
                            {% if order.images.all %}
                            <div class="mt-4 pt-4 border-t border-gray-100">
                                <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                                    <i class="fas fa-images ml-2 text-gray-400"></i>
                                    عکس‌های آپلود شده ({{ order.images.count }})
                                </h4>
                                <div class="grid grid-cols-3 gap-2">
                                    {% for image in order.images.all %}
                                    <div class="relative group">
                                        <img src="{{ image.image.url }}"
                                             alt="عکس منو {{ forloop.counter }}"
                                             class="w-full h-20 object-cover rounded-lg border">
                                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 rounded-lg transition-all flex items-center justify-center">
                                            <button onclick="viewImage('{{ image.image.url }}')"
                                                    class="w-8 h-8 bg-white text-gray-700 rounded-full text-sm flex items-center justify-center hover:bg-gray-100 transition-all opacity-0 group-hover:opacity-100">
                                                <i class="fas fa-expand"></i>
                                            </button>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}
                        </div>

                        <!-- دکمه‌های اقدام داینامیک -->
                        <div class="flex flex-col space-y-3 min-w-[200px]">
                            {% if order.status == 1 %}
                            <!-- وضعیت پرداخت نشده -->
                            <button onclick="processRealPayment({{ order.id }})"
                                    class="w-full bg-red-500 hover:bg-red-600 text-white px-4 py-3 rounded-xl text-sm font-medium transition-all duration-300 flex items-center justify-center">
                                <i class="fas fa-credit-card ml-2"></i>
                                پرداخت ({{ order.get_price_display }})
                            </button>
                            {% elif order.status == 2 %}
                            <!-- وضعیت پرداخت شده -->
                            <span class="w-full bg-green-500 text-white px-4 py-3 rounded-xl text-sm font-medium text-center flex items-center justify-center">
                                <i class="fas fa-check-circle ml-2"></i>
                                پرداخت شده
                            </span>
                            {% elif order.status == 3 %}
                            <!-- وضعیت تایید شده -->
                            <span class="w-full bg-purple-500 text-white px-4 py-3 rounded-xl text-sm font-medium text-center flex items-center justify-center">
                                <i class="fas fa-clipboard-check ml-2"></i>
                                تایید شده
                            </span>
                            {% elif order.status == 4 %}
                            <!-- وضعیت تحویل شده -->
                            <span class="w-full bg-blue-500 text-white px-4 py-3 rounded-xl text-sm font-medium text-center flex items-center justify-center">
                                <i class="fas fa-check-double ml-2"></i>
                                تحویل شده
                            </span>
                            {% elif order.status == 5 %}
                            <!-- وضعیت تمدید شده -->
                            <span class="w-full bg-teal-500 text-white px-4 py-3 rounded-xl text-sm font-medium text-center flex items-center justify-center">
                                <i class="fas fa-sync-alt ml-2"></i>
                                تمدید شده
                            </span>
                            {% elif order.status == 6 %}
                            <!-- وضعیت تمدید نشده -->
                            <button onclick="processRealPayment({{ order.id }})"
                                    class="w-full bg-orange-500 hover:bg-orange-600 text-white px-4 py-3 rounded-xl text-sm font-medium transition-all duration-300 flex items-center justify-center">
                                <i class="fas fa-credit-card ml-2"></i>
                                تمدید ({{ order.get_price_display }})
                            </button>
                            {% endif %}

                            <button onclick="viewOrderDetails({{ order.id }})"
                                    class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-3 rounded-xl text-sm font-medium transition-all duration-300 flex items-center justify-center">
                                <i class="fas fa-eye ml-2"></i>
                                مشاهده جزئیات
                            </button>

                            {% if order.status == 1 or order.status == 6 %}
                            <button onclick="cancelOrder({{ order.id }})"
                                    class="w-full border border-red-300 hover:bg-red-50 text-red-600 px-4 py-3 rounded-xl text-sm font-medium transition-all duration-300 flex items-center justify-center">
                                <i class="fas fa-times ml-2"></i>
                                لغو سفارش
                            </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endwith %}
                {% endfor %}
            </div>
            {% else %}
            <!-- حالت خالی -->
            <div class="text-center py-12">
                <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center text-gray-400 mx-auto mb-4">
                    <i class="fas fa-shopping-cart text-3xl"></i>
                </div>
                <h3 class="text-gray-500 text-lg font-medium mb-2">هنوز سفارشی ثبت نکرده‌اید</h3>
                <p class="text-gray-400 mb-6">سفارشات ساخت منو در این بخش نمایش داده می‌شوند</p>
                <button onclick="openCreateRestaurantModal()"
                        class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-xl font-medium transition-colors">
                    ساخت اولین منو
                </button>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- محتوای اصلی - طرح دو ستونی برای دسکتاپ -->
    <div class="flex flex-col xl:flex-row gap-6">

        <!-- ستون سمت چپ - سفارشات زنده و آمار -->
        <div class="xl:w-2/3 space-y-6">

            <!-- آمار سریع -->

        </div>

        <!-- ستون سمت راست - منوها و نکات -->
        <div class="xl:w-1/3 space-y-6">

            <!-- منوهای شما -->
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100">
                <div class="p-6 border-b border-gray-100">
                    <h2 class="text-xl font-bold text-gray-800 flex items-center">
                        <i class="fas fa-utensils text-blue-500 ml-3 text-lg"></i>
                        منوهای شما
                    </h2>
                </div>

                <div class="p-6">
                    {% if user_restaurants %}
                    <div class="space-y-4">
                        {% for restaurant in user_restaurants %}
                        <div class="border border-gray-200 rounded-xl p-4 hover:shadow-md transition-all duration-300">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <h3 class="font-semibold text-gray-800 mb-2">{{ restaurant.title }}</h3>
                                    <p class="text-gray-500 text-sm mb-3 flex items-center">
                                        <i class="fas fa-link ml-1 text-gray-400"></i>
                                        /menu/{{ restaurant.slug }}
                                    </p>
                                    <div class="flex items-center space-x-2 space-x-reverse flex-wrap gap-2">
                                        <span class="bg-green-100 text-green-600 px-2 py-1 rounded text-xs font-medium">
                                            {{ restaurant.foods.count }} غذا
                                        </span>
                                        <span class="bg-blue-100 text-blue-600 px-2 py-1 rounded text-xs font-medium">
                                            {{ restaurant.categories.count }} دسته‌بندی
                                        </span>
                                        <span class="bg-purple-100 text-purple-600 px-2 py-1 rounded text-xs font-medium">
                                            {{ restaurant.orders.count }} سفارش
                                        </span>
                                    </div>
                                </div>
                                <div class="flex flex-col space-y-2 mr-4">
                                    <a href="{% url 'panel:restaurant_admin' slug=restaurant.slug %}"
                                       class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-xs text-center transition-colors whitespace-nowrap">
                                        مدیریت منو
                                    </a>
                                    <button onclick="copyMenuLink('{{ restaurant.slug }}')"
                                            class="bg-gray-100 hover:bg-gray-200 text-gray-600 px-4 py-2 rounded-lg text-xs transition-colors whitespace-nowrap">
                                        کپی لینک
                                    </button>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-8">
                        <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center text-gray-400 mx-auto mb-4">
                            <i class="fas fa-utensils text-2xl"></i>
                        </div>
                        <p class="text-gray-500 mb-4">هنوز منویی نساخته‌اید</p>
                        <button onclick="openCreateRestaurantModal()"
                                class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-xl font-medium transition-colors">
                            ساخت اولین منو
                        </button>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- نکات و پیشنهادات -->
            <div class="bg-gradient-to-br from-blue-50 to-indigo-100 border border-blue-200 rounded-2xl p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-lightbulb text-yellow-500 ml-2"></i>
                    راهنمای افزایش فروش
                </h3>

                <div class="space-y-3">
                    <div class="flex items-start space-x-3 space-x-reverse">
                        <div class="w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0 mt-1">
                            <i class="fas fa-qrcode text-white text-xs"></i>
                        </div>
                        <p class="text-sm text-gray-700">
                            <strong>QR Code روی میزها:</strong> برای افزایش ۳ برابری سفارشات
                        </p>
                    </div>

                    <div class="flex items-start space-x-3 space-x-reverse">
                        <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0 mt-1">
                            <i class="fas fa-image text-white text-xs"></i>
                        </div>
                        <p class="text-sm text-gray-700">
                            <strong>عکس‌های باکیفیت:</strong> ۶۰٪ افزایش جذابیت منو
                        </p>
                    </div>

                    <div class="flex items-start space-x-3 space-x-reverse">
                        <div class="w-6 h-6 bg-purple-500 rounded-full flex items-center justify-center flex-shrink-0 mt-1">
                            <i class="fas fa-bolt text-white text-xs"></i>
                        </div>
                        <p class="text-sm text-gray-700">
                            <strong>توضیحات صوتی:</strong> تجربه متفاوت برای مشتریان
                        </p>
                    </div>
                </div>

                <div class="mt-6 pt-4 border-t border-blue-200">
                    <a href="#" class="text-blue-600 hover:text-blue-700 text-sm font-medium flex items-center">
                        راهنمای کامل استفاده
                        <i class="fas fa-arrow-left mr-2"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- مودال نمایش عکس -->
<div id="imageModal" class="fixed inset-0 bg-black bg-opacity-90 hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="relative w-full max-w-4xl">
            <button onclick="closeImageModal()"
                    class="absolute -top-12 left-0 text-white text-2xl hover:text-gray-300 transition-colors">
                <i class="fas fa-times"></i>
            </button>
            <img id="modalImage" src="" alt="عکس منو" class="w-full h-auto rounded-lg">
        </div>
    </div>
</div>

<script>
// پرداخت واقعی - انتقال به درگاه پرداخت
function processRealPayment(orderId) {
    if (confirm('آیا می‌خواهید به درگاه پرداخت منتقل شوید؟')) {
        // نمایش وضعیت در حال پردازش
        showNotification('در حال انتقال به درگاه پرداخت...', 'info');

        // انتقال به درگاه پرداخت واقعی
        window.location.href = `/peyment/request/${orderId}/`;
    }
}

// مشاهده جزئیات سفارش
function viewOrderDetails(orderId) {
    // در اینجا می‌توانید صفحه جزئیات سفارش را باز کنید
    window.open(`/panel/orders/${orderId}/`, '_blank');
}

// لغو سفارش
function cancelOrder(orderId) {
    if (confirm('آیا از لغو این سفارش مطمئن هستید؟')) {
        fetch(`/panel/orders/${orderId}/cancel/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('سفارش با موفقیت لغو شد ✅');
                setTimeout(() => {
                    location.reload();
                }, 1500);
            } else {
                showNotification('خطا در لغو سفارش: ' + data.message, 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('خطا در ارتباط با سرور ❌', 'error');
        });
    }
}

// مشاهده عکس در مودال
function viewImage(imageUrl) {
    document.getElementById('modalImage').src = imageUrl;
    document.getElementById('imageModal').classList.remove('hidden');
}

function closeImageModal() {
    document.getElementById('imageModal').classList.add('hidden');
}

// تابع کپی لینک منو
function copyMenuLink(slug) {
    const link = `${window.location.origin}/menu/${slug}`;
    navigator.clipboard.writeText(link).then(() => {
        showNotification('لینک منو در کلیپ‌بورد کپی شد ✅');
    });
}

// تابع نمایش نوتیفیکیشن
function showNotification(message, type = 'success') {
    // ایجاد نوتیفیکیشن
    const notification = document.createElement('div');
    notification.className = `fixed top-6 left-1/2 transform -translate-x-1/2 z-50 px-6 py-3 rounded-xl shadow-lg text-white font-medium ${
        type === 'success' ? 'bg-green-500' :
        type === 'error' ? 'bg-red-500' :
        'bg-blue-500'
    } animate-bounce`;
    notification.textContent = message;
    document.body.appendChild(notification);

    setTimeout(() => {
        notification.remove();
    }, 3000);
}

// بررسی نمایش بنر - هر بار برای کاربران بدون منو
function checkFirstTimeVisit() {
    const hasRestaurants = {{ user_restaurants.count|default:0 }} > 0;

    // اگر کاربر منو دارد، بنر نمایش داده نشود
    if (hasRestaurants) {
        return;
    }

    // 2 ثانیه تاخیر برای بهتر دیده شدن
    setTimeout(() => {
        const banner = document.getElementById('firstTimeBanner');
        banner.classList.remove('hidden');
        setTimeout(() => {
            banner.querySelector('.animate-in').classList.remove('scale-95');
        }, 100);
    }, 2000);
}

// شروع ساخت منو
function startCreatingMenu() {
    closeFirstTimeBanner();
    openCreateRestaurantModal();
}

// بستن بنر
function closeFirstTimeBanner() {
    const banner = document.getElementById('firstTimeBanner');
    banner.querySelector('.animate-in').classList.add('scale-95');
    setTimeout(() => {
        banner.classList.add('hidden');
    }, 300);
}

// شروع به‌روزرسانی‌های زنده
document.addEventListener('DOMContentLoaded', function() {
    checkFirstTimeVisit();
});

// بستن با کلیک خارج از بنر
document.getElementById('firstTimeBanner').addEventListener('click', function(e) {
    if (e.target === this) {
        closeFirstTimeBanner();
    }
});

document.getElementById('imageModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeImageModal();
    }
});

// بستن با دکمه ESC
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        const banner = document.getElementById('firstTimeBanner');
        if (!banner.classList.contains('hidden')) {
            closeFirstTimeBanner();
        }
        const imageModal = document.getElementById('imageModal');
        if (!imageModal.classList.contains('hidden')) {
            closeImageModal();
        }
    }
});
</script>

<style>
.hover-lift:hover {
    transform: translateY(-4px);
    transition: transform 0.3s ease;
}

.animate-pulse {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

@keyframes pulse {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: 0.7;
    }
}

.animate-bounce {
    animation: bounce 0.5s;
}

@keyframes bounce {
    0%, 20%, 53%, 80%, 100% {
        transform: translate3d(-50%, 0, 0);
    }
    40%, 43% {
        transform: translate3d(-50%, -15px, 0);
    }
    70% {
        transform: translate3d(-50%, -10px, 0);
    }
    90% {
        transform: translate3d(-50%, -5px, 0);
    }
}

.animate-in {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.animate-in {
    animation: slideInUp 0.5s ease-out;
}

/* بهبود نمایش در موبایل‌های مختلف */
@media (max-width: 380px) {
    #firstTimeBanner .max-w-sm {
        max-width: 95vw;
        margin: 0 auto;
    }
}

/* حذف اسکرول هنگام نمایش بنر */
body:has(#firstTimeBanner:not(.hidden)) {
    overflow: hidden;
}

/* responsive improvements */
@media (max-width: 768px) {
    .container {
        padding-left: 1rem;
        padding-right: 1rem;
    }
}

@media (min-width: 1536px) {
    .container {
        max-width: 1280px;
    }
}

.status-badge {
    display: inline-flex;f
    align-items: center;
    transition: all 0.3s ease;
}

.status-badge:hover {
    transform: scale(1.05);
}
</style>